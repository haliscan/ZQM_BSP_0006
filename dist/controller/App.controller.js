sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","../model/formatter","sap/m/Text","sap/m/Button","sap/m/Dialog","sap/m/MessageView","sap/m/MessageItem"],(BaseController,MessageBox,formatter,Text,Button,Dialog,MessageView,MessageItem)=>{"use strict";var oData;return BaseController.extend("com.karsan.qm.taskmanage.controller.App",{formatter:formatter,onInit:function(){oData=this.getOwnerComponent().getModel();oData.setSizeLimit(1e6)},getRouter:function(){return this.getOwnerComponent().getRouter()},getModel:function(e){return this.getView().getModel(e)},getViewModel:function(){return this.getView().getModel("viewModel")},getText(e){let t=this.getModel("i18n").getResourceBundle();return t.getText(e)},confirmAction(e){let t=this;return new Promise(function(s){var r=new Dialog({title:t.getText("AreYouSure"),type:"Message",state:"Warning",content:new Text({text:e}),beginButton:new Button({text:t.getText("Yes"),type:"Emphasized",press:function(){r.close();s(true)}}),endButton:new Button({text:t.getText("Cancel"),type:"Reject",press:function(){r.close();s(false)}}),afterClose:function(){r.destroy()}});t.getView().addDependent(r);r.open()})},readEntity:function(e,t={}){return new Promise(function(s,r){oData.read("/"+e,{urlParameters:t.urlParameters||{},success:function(e){s(e)},error:function(e){r(e)}})})},readEntitySet:function(e,t={}){return new Promise(function(s,r){oData.read("/"+e,{filters:t.filters||[],urlParameters:t.urlParameters||{},success:function(e){s(e)},error:function(e){r(e)}})})},_showMessage:function(e){e=Array.isArray(e)?e:e?[e]:[];let t=this.getViewModel().getProperty("/Messages")||[];let s=this._formatMessage([...t,...e]);this.getViewModel().setProperty("/Messages",s);this.getViewModel().refresh(true);if(!s||s.length===0){return}if(!this._oDMessages){const e=new MessageView;e.setModel(this.getViewModel(),"viewModel");e.unbindAggregation("items");e.attachActiveTitlePress(function(e){const t=e.getParameter("item");if(t){const e=t.getBindingContext("viewModel").getProperty("controlId");if(e){const t=this.getView().byId(e);if(t){t.focus();if(t.setValueState){t.setValueState("Error");this.onCloseDMessages()}}}}}.bind(this));e.bindAggregation("items",{model:"viewModel",path:"/Messages",templateShareable:false,template:new MessageItem({type:"{viewModel>type}",title:"{viewModel>title}",subtitle:"{viewModel>subtitle}",description:"{viewModel>description}",groupName:"{viewModel>groupName}",activeTitle:"{viewModel>activeTitle}"})});this._oDMessages=new Dialog({title:this.getText("DMessagesTitle")||"Mesajlar",type:"Message",contentWidth:"50%",contentHeight:"60vh",resizable:true,draggable:true,state:"Information",content:[e],endButton:new Button({text:this.getText("Close")||"Kapat",press:function(){this.onCloseDMessages()}.bind(this)}),afterOpen:function(){const t=e.$();if(t&&t.length){const e=window.innerHeight||$(window).height();const s=Math.max(200,Math.round(e*.6)-120);t.css({height:s+"px",overflow:"auto"})}}});this.getView().addDependent(this._oDMessages);this._oMessageView=e}setTimeout(function(){this._setValueStateByMessages();this._oDMessages.open()}.bind(this),0)},_setValueStateByMessages:function(){let e=this.getViewModel().getProperty("/Messages")||[];e.forEach(e=>{if(e.controlId&&e.type==="Error"){this.getView().byId(e.controlId)?.setValueState("Error")}})},onCloseDMessages:function(){this._clearMessages();if(this._oDMessages){this._oDMessages.close()}let aAction=this.getViewModel().getProperty("/WaitingAction");aAction.sort((e,t)=>e.seqnr-t.seqnr);aAction.forEach(oAction=>{eval(`${oAction.function}(oAction.event)`)});this.getViewModel().setProperty("/WaitingAction",[])},_formatMessage:function(e){if(!Array.isArray(e)){e=[e]}const t=e=>{if(!e){return"None"}switch(e){case"S":return"Success";case"W":return"Warning";case"E":return"Error";case"A":return"Error";case"X":return"Error";case"I":return"Information";default:return e}};const s=new Set;const r=[];if(!Array.isArray(e)){return r}e.forEach(e=>{const o=(e.description||e.Message||e.message||"").toString();if(!o){return}if(s.has(o)){return}s.add(o);const n={type:e.type||t(e.Type)||"None",title:(e.title||o).toString(),subtitle:(e.subtitle||e.Id+e.Number||"").toString(),description:o,groupName:(e.groupName||"").toString(),activeTitle:e.activeTitle||false,controlId:e.controlId||null};r.push(n)});return r},_addMessage:function(e){let t=this._formatMessage(e);let s=this.getViewModel().getProperty("/Messages")||[];t.forEach(e=>{const t=s.some(t=>t.description===e.description);if(!t){s.push(e)}});this.getViewModel().setProperty("/Messages",s)},_clearMessages:function(){this.getViewModel().setProperty("/Messages",[])},getCurrentTimeEdmFormat(){const e=new Date;const t=e.getHours()*36e5+e.getMinutes()*6e4+e.getSeconds()*1e3;return{ms:t,__edmType:"Edm.Time"}},_formatDate:function(e){if(e instanceof Date){var t=e.getTimezoneOffset();e.setMinutes(e.getMinutes()-t)}return e},_removeSpaces(e){if(typeof e==="string"){return e.replace(/^\s+/,"")}return e},onCallFunction(e,t,s,r){return new Promise((o,n)=>{const i={method:t,urlParameters:r,success:o,error:n};s.callFunction(e,i)})},onCreate(e,t,s){return new Promise((r,o)=>{const n={success:r,error:o};s.create(e,t,n)})},onDelete(e,t){return new Promise((s,r)=>{const o={success:s,error:r};t.remove(e,o)})},onRead(e,t){return new Promise((s,r)=>{const o={success:s,error:r};t.read(e,o)})},onReadAssociation(e,t,s){return new Promise((r,o)=>{const n={urlParameters:t,success:r,error:o};s.read(e,n)})},onReadExpanded(e,t,s,r){return new Promise((o,n)=>{const i={filters:t,urlParameters:s,success:o,error:n};r.read(e,i)})},onReadQuery(e,t,s){return new Promise((r,o)=>{const n={filters:t,success:r,error:o};s.read(e,n)})},onReadQueryAsyncSorters(e,t,s,r,o){return new Promise((n,i)=>{const a={async:s,filters:t,sorters:r,success:n,error:i};o.read(e,a)})},onReadQueryParameters(e,t,s,r){return new Promise((o,n)=>{const i={filters:t,urlParameters:r,success:o,error:n};s.read(e,i)})},onSubmitChanges(e){return new Promise((t,s)=>{const r={success:t,error:s};e.submitChanges(r)})},onUpdate(e,t,s){return new Promise((r,o)=>{const n={success:r,error:o};s.update(e,t,n)})}})});
//# sourceMappingURL=App.controller.js.map