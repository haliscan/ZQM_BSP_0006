sap.ui.define(["../controller/App.controller","../model/formatter","sap/m/MessageBox","sap/ui/core/BusyIndicator"],(e,t,i,n)=>{"use strict";return e.extend("com.karsan.qm.taskmanage.controller.Report",{formatter:t,onInit:function(){this.getRouter().getRoute("Report").attachMatched(this._onRouteMatched,this)},_onRouteMatched:function(){this.getOwnerComponent().getModel().metadataLoaded().then(()=>{this._getUserInformation()});this._setSFBconfig()},_getUserInformation:function(){if(window.top===window)return;n.show();this._readBtpWorkzoneId().then(e=>{const t=e.BtpWorkzoneID||e.BtpLinkID||e.BtpLink||"";const i=async e=>{if(e.origin!==t)return;try{const t=JSON.parse(e.data);if(t?.RequestID==="UserMailRequest"&&t.UserMail){clearInterval(n);window.removeEventListener("message",i);await this._verifySupplierEmail(t.UserMail)}}catch(e){this._rejectInvalidUserAccess(i,n)}};window.addEventListener("message",i);const n=setInterval(()=>{window.top.postMessage(JSON.stringify({RequestID:"UserMailRequest"}),t)},3e3)}).catch(()=>{n.hide();this._rejectInvalidUserAccess()})},_readBtpWorkzoneId:function(e){const t=this.getOwnerComponent().getModel("btpService");return new Promise((e,i)=>{t.read(`/BtpLinkSet('OWN')`,{success:e,error:i})})},_verifySupplierEmail:async function(e){try{const t=await this._readUserByEmail(e);this.getView().getModel().setHeaders({email:e});n.hide()}catch(e){this._rejectInvalidUserAccess()}},_readUserByEmail:function(e){const t=this.getOwnerComponent().getModel("btpService");return new Promise((i,n)=>{t.read(`/SupplierLogonInfoSet('${e}')`,{success:i,error:n})})},_rejectInvalidUserAccess:function(e,t){n.hide();if(t)clearInterval(t);if(e)window.removeEventListener("message",e);let o=this.getView().getModel("i18n").getProperty("AuthSupplierNotFound");i.error(o,{actions:[i.Action.CLOSE],onClose:()=>{history.go(-1)}})},onSelectNotif:function(e){var t=e.getParameter("rowBindingContext").getObject();this.getViewModel().setProperty("/NavParams",{View:"Notif",Qmnum:t.Qmnum,Manum:t.Manum,Action:"Display"});this.getRouter().navTo("Task",{Qmnum:t.Qmnum,Manum:t.Manum})},_setSFBconfig:function(){var e=this.byId("idSfbReportSet");if(e){e.attachInitialise(function(){var t=["Qmart"];t.forEach(function(t){var i=e.getControlByKey(t);if(i&&typeof i.setEnabled==="function"){i.setEnabled(false)}if(i&&typeof i.setEditable==="function"){i.setEditable(false)}})})}},_toggleVisibleSupplierFilter:function(){var e=this.byId("idSfbReportSet");if(e){var t=e.getControlByKey("Lifnum");if(t){t.setVisible(!t.getVisible())}}}})});
//# sourceMappingURL=Report.controller.js.map